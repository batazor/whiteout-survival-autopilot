name: Heal Injured Troops

node: heal_injured

priority: 45

trigger: healInjured.state.isAvailable

steps:
  - action: loop
    trigger: compareText(healInjured.state.isNext, "Heal Injured")
    steps:
      - if: # –µ—Å–ª–∏ —Ç–µ–∫—É—à–∏–π —Å—Ç–∞—Ç—É—Å -> "–õ–µ—á–∏—Ç—å"
          trigger: compareText(healInjured.state.statusHeal, "Heal")
          then:
            - click: heal_injured_help_button # –ù–∞—á–∏–Ω–∞–µ–º –ª–µ—á–µ–Ω–∏–µ
            - wait: 200ms
            - action: screenshot # –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–∫–Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
              analyze:
                - name: healInjured.state.isReplenishAll
                  action: color_check
                  expectedColorBg: blue
                  threshold: 0.5

            - if:
                trigger: healInjured.state.isReplenishAll # –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤
                then:
                  - click: healInjured.state.isReplenishAll # –ë–µ—Ä–µ–º —Ä–µ—Å—É—Ä—Å—ã –∏–∑ –º–µ—à–∫–∞
                  - wait: 200ms
                  - click: heal_injured_help_button # –ù–∞—á–∏–Ω–∞–µ–º –ª–µ—á–µ–Ω–∏–µ
                  - wait: 100ms
            - click: heal_injured_help_button # –ü—Ä–æ—Å–∏–º –ø–æ–º–æ—â—å

            - wait: 2s

            - action: screenshot # –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–∫–Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
              analyze:
                - name: healInjured.state.isNext
                  action: text
                  type: string
                  threshold: 0.7
                - name: healInjured.state.statusHeal
                  action: text
                  type: string
                  threshold: 0.7
      - if: # –µ—Å–ª–∏ —Ç–µ–∫—É—à–∏–π —Å—Ç–∞—Ç—É—Å -> "–õ–µ—á–∏—Ç—å"
          trigger: alliance.state.isNeedSupport
          then:
            - click: alliance.state.isNeedSupport
            - action: screenshot               # üì∏ –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —ç–∫—Ä–∞–Ω–∞
              analyze:
                - name: alliance.state.isNeedSupport
                  action: exist
                  threshold: 0.7
      - action: screenshot # –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–∫–∏ –ª–µ—á–µ–Ω–∏—è
        analyze:
          - name: healInjured.state.statusHeal
            action: text
            type: string
            threshold: 0.7
          - name: screenState.titleFact
            action: text
            type: string
            threshold: 0.9
      - if: # fallback: –Ω–∞ —Å–ª—É—á–∞–π –º–∏—Å–∫–ª–∏–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–º–æ—â—å
          trigger: compareText(screenState.titleFact, "Chat")
          then:
            - action: loop_stop
